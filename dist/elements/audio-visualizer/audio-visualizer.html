<!--

Copyright 2015 Google Inc. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

--><html><head><meta charset="UTF-8"></head><body><div hidden by-vulcanize><link rel="import" href="../../third_party/polymer.html"></div><dom-module id="audio-visualizer">
  <style>#container,#pitch{width:100%;height:100%}:host{will-change:transform}#container{position:absolute;left:0;top:0}#pitch{display:block;margin:0 auto;will-change:transform}</style>
  <template>
    <div id="container">
      <canvas id="pitch"></canvas>
      <content></content>
    </div>
  </template>
</dom-module>

<script>!function t(i,e,s){function r(a,n){if(!e[a]){if(!i[a]){var o="function"==typeof require&&require;if(!n&&o)return o(a,!0);if(h)return h(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=e[a]={exports:{}};i[a][0].call(d.exports,function(t){var e=i[a][1][t];return r(e||t)},d,d.exports,t,i,e,s)}return e[a].exports}for(var h="function"==typeof require&&require,a=0;a<s.length;a++)r(s[a]);return r}({1:[function(t,i,e){"use strict";function s(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),h=function(){function t(){s(this,t),Polymer(t.prototype)}return r(t,[{key:"created",value:function(){this.audioProcessor=document.querySelector("audio-processor"),this.surroundCanvas=document.createElement("canvas"),this.hasPrerenderedSurroundAndNoteMarkers=!1,this.onAudioData=this.onAudioData.bind(this),this.waitForDimensions=this.waitForDimensions.bind(this),this.draw=this.draw.bind(this),this.onResize=this.onResize.bind(this),this.dialAngle=2*Math.PI,this.realDialAngle=2*Math.PI,this.note="C",this.octave="4th octave"}},{key:"attached",value:function(){this.canvas=this.$.pitch,this.ctx=this.canvas.getContext("2d"),this.surroundCtx=this.surroundCanvas.getContext("2d"),this.audioProcessor.addEventListener("audio-data",this.onAudioData),this.gradientLeft=this.ctx.createLinearGradient(-16,0,0,0),this.gradientLeft.addColorStop(0,"rgba(0,0,0,0)"),this.gradientLeft.addColorStop(1,"rgba(0,0,0,0.2)"),this.gradientRight=this.ctx.createLinearGradient(0,0,16,0),this.gradientRight.addColorStop(0,"rgba(0,0,0,0.2)"),this.gradientRight.addColorStop(1,"rgba(0,0,0,0)"),this.gradientDialShadow=this.ctx.createLinearGradient(0,0,55,55),this.gradientDialShadow.addColorStop(0,"rgba(0,0,0,0.3)"),this.gradientDialShadow.addColorStop(1,"rgba(0,0,0,0)"),this.gradientInnerCircleShadow=this.ctx.createLinearGradient(0,0,0,100),this.gradientInnerCircleShadow.addColorStop(0,"rgba(0,0,0,0.3)"),this.gradientInnerCircleShadow.addColorStop(1,"rgba(0,0,0,0)"),window.addEventListener("resize",this.onResize),requestAnimationFrame(this.waitForDimensions)}},{key:"detached",value:function(){this.audioProcessor.removeEventListener("audio-data",this.onAudioData),window.removeEventListener("resize",this.onResize)}},{key:"waitForDimensions",value:function(){return this.width=this.canvas.parentElement.offsetWidth,this.height=this.canvas.parentElement.offsetHeight,0===this.width||0===this.height?void requestAnimationFrame(this.waitForDimensions):(this.classList.add("resolved"),this.onResize(),void requestAnimationFrame(this.draw))}},{key:"onResize",value:function(){var t=window.devicePixelRatio||1;this.canvas.style.display="none",this.width=this.canvas.parentElement.offsetWidth,this.height=this.canvas.parentElement.offsetHeight,this.canvas.style.display="block",this.canvas.width=this.width*t,this.canvas.height=this.height*t,this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.ctx.scale(t,t),this.hasPrerenderedSurroundAndNoteMarkers=!1}},{key:"onAudioData",value:function(t){var i=2*Math.PI,e=t.detail.frequency,s=Math.log2(e/440),r=(s*i-.5*Math.PI)%i,h=(r-this.realDialAngle)%i;Math.abs(h)>Math.PI&&(h=(h+i)%i),this.realDialAngle=this.realDialAngle+h,this.note=a.convertNote(t.detail.note),this.octave=a.convertOctave(t.detail.octave)}},{key:"draw",value:function(){var t=Math.min(this.width,this.height),i=Math.round(.5*t),e=Math.round(i-.18*t);this.ctx.clearRect(0,0,this.width,this.height),this.dialAngle+=.15*(this.realDialAngle-this.dialAngle),this.hasPrerenderedSurroundAndNoteMarkers||this.prerenderSurroundAndNoteMarkers(i,e),this.drawSurroundAndNoteMarkers(i,e),this.drawDialShadow(i),this.drawDial(i),this.drawInnerCircle(i),requestAnimationFrame(this.draw)}},{key:"prerenderSurroundAndNoteMarkers",value:function(t,i){this.hasPrerenderedSurroundAndNoteMarkers=!0;var e=2*Math.PI,s=e/12,r=window.devicePixelRatio||1;this.surroundCanvas.width=this.width*r,this.surroundCanvas.height=this.height*r,this.surroundCtx.scale(r,r),this.surroundCtx.fillStyle="#FF9800",this.surroundCtx.beginPath(),this.surroundCtx.arc(.5*this.width,.5*this.height,t,0,e),this.surroundCtx.closePath(),this.surroundCtx.fill(),this.surroundCtx.save(),this.surroundCtx.translate(.5*this.width,.5*this.height),this.surroundCtx.translate(.5,.5),this.surroundCtx.rotate(-.5*s),this.surroundCtx.strokeStyle="rgba(0,0,0,0.1)",this.surroundCtx.fillStyle="#FFF",this.surroundCtx.textBaseline="middle",this.surroundCtx.textAlign="center";for(var h=0;h<12;h++){var n=(h+3)%12,o=a.convertNote(n),l=o.length>1;this.surroundCtx.save(),this.surroundCtx.beginPath(),this.surroundCtx.rotate(h*s),this.surroundCtx.moveTo(0,-t),this.surroundCtx.lineTo(0,0),this.surroundCtx.stroke(),this.surroundCtx.closePath(),this.surroundCtx.rotate(.5*s),this.surroundCtx.font="normal 400 20px Roboto",this.surroundCtx.fillText(o[0],0,.5*(t-i)-t),l&&(this.surroundCtx.save(),this.surroundCtx.translate(12,.5*(t-i)-t-6),this.surroundCtx.scale(.7,.7),this.surroundCtx.font="normal 400 20px sans-serif",this.surroundCtx.fillText(o[1],0,0),this.surroundCtx.restore()),this.surroundCtx.restore()}this.surroundCtx.restore(),this.surroundCtx.save(),this.surroundCtx.globalCompositeOperation="destination-out",this.surroundCtx.beginPath(),this.surroundCtx.arc(.5*this.width,.5*this.height,i,0,e),this.surroundCtx.closePath(),this.surroundCtx.fill(),this.surroundCtx.restore()}},{key:"drawSurroundAndNoteMarkers",value:function(){var t=1/(window.devicePixelRatio||1);this.ctx.save(),this.ctx.scale(t,t),this.ctx.drawImage(this.surroundCanvas,0,0),this.ctx.restore()}},{key:"drawDialShadow",value:function(t){var i=1-Math.pow(.5*(1+Math.cos(this.dialAngle+1.25*Math.PI)),3);i=Math.min(1,i),this.ctx.save(),this.ctx.translate(.5*this.width,.5*this.height);var e=[{x:-16*Math.sin(this.dialAngle),y:16*Math.cos(this.dialAngle)},{x:-16*Math.cos(this.dialAngle),y:-16*Math.sin(this.dialAngle)},{x:-16*Math.cos(this.dialAngle-.25*Math.PI),y:-16*Math.sin(this.dialAngle-.25*Math.PI)},{x:16*Math.cos(this.dialAngle),y:16*Math.sin(this.dialAngle)},{x:16*Math.cos(this.dialAngle+.25*Math.PI),y:16*Math.sin(this.dialAngle+.25*Math.PI)},{x:Math.sin(this.dialAngle)*(t-3),y:Math.cos(this.dialAngle)*-(t-3)}],s=e.length-1,r=Math.sin(.25*Math.PI),h=Math.cos(.25*Math.PI);e.sort(function(t,i){return t.x*h-t.y*r-(i.x*h-i.y*r)}),this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y),this.ctx.lineTo(e[s].x,e[s].y),this.ctx.lineTo(e[s].x+this.height,e[s].y+this.height),this.ctx.lineTo(e[0].x+this.height,e[0].y+this.height),this.ctx.closePath(),this.ctx.clip();var a=Math.sin(this.dialAngle)*t*.5,n=Math.cos(this.dialAngle)*t*.5;this.ctx.globalAlpha=i,this.ctx.translate(a,-n),this.ctx.fillStyle=this.gradientDialShadow,this.ctx.fillRect(.5*-t-16,.5*-t-16,this.width,this.height),this.ctx.restore()}},{key:"drawDial",value:function(t){var i=.5*(Math.cos(this.dialAngle-.25*Math.PI)+1);this.ctx.save(),this.ctx.translate(.5*this.width,.5*this.height),this.ctx.rotate(this.dialAngle),this.ctx.beginPath(),this.ctx.arc(.5,0,16,.5*Math.PI,-Math.PI),this.ctx.arc(.5,6-t,3,-Math.PI,.5*-Math.PI),this.ctx.closePath(),this.ctx.globalAlpha=1,this.ctx.fillStyle="#FFF",this.ctx.fill(),this.ctx.globalAlpha=1-i,this.ctx.fillStyle=this.gradientLeft,this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(-.5,6-t,3,.5*-Math.PI,0),this.ctx.arc(-.5,0,16,0,.5*Math.PI),this.ctx.closePath(),this.ctx.globalAlpha=1,this.ctx.fillStyle="#FFF",this.ctx.fill(),this.ctx.globalAlpha=i,this.ctx.fillStyle=this.gradientRight,this.ctx.fill(),this.ctx.restore()}},{key:"drawInnerCircle",value:function(t){var i=2*Math.PI,e=this.note.length>1,s=Math.round(.47*t);this.ctx.save(),this.ctx.translate(.5*this.width,.5*this.height),this.ctx.save(),this.ctx.rotate(.25*-Math.PI),this.ctx.fillStyle=this.gradientInnerCircleShadow,this.ctx.fillRect(-s,0,2*s,2*s),this.ctx.restore(),this.ctx.beginPath(),this.ctx.arc(0,0,s,0,i),this.ctx.closePath(),this.ctx.fillStyle="#B0BEC5",this.ctx.fill(),this.ctx.fillStyle="#FFF",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.font="normal 100 80px Roboto",this.ctx.fillText(this.note[0],0,-8),e&&(this.ctx.save(),this.ctx.translate(32,-28),this.ctx.scale(.5,.5),this.ctx.font="normal 100 80px sans-serif",this.ctx.fillText(this.note[1],0,0),this.ctx.restore()),this.ctx.globalAlpha=.87,this.ctx.textBaseline="top",this.ctx.font="normal 400 12px Roboto",this.ctx.fillText(this.octave,0,32),this.ctx.restore()}},{key:"is",get:function(){return"audio-visualizer"}}]),t}(),a=function(){function t(){s(this,t)}return r(t,null,[{key:"convertOctave",value:function(t){var i="Octave";switch(t){case 1:return t+"st "+i;case 2:return t+"nd "+i;case 3:return t+"rd "+i;default:return t+"th "+i}}},{key:"convertNote",value:function(t){switch(t){case 0:return"A";case 1:return"B♭";case 2:return"B";case 3:return"C";case 4:return"C#";case 5:return"D";case 6:return"E♭";case 7:return"E";case 8:return"F";case 9:return"F#";case 10:return"G";case 11:return"G#"}}}]),t}();new h},{}]},{},[1]);</script>
</body></html>